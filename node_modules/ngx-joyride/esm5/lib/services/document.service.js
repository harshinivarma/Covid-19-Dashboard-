/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/document.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { DomRefService } from './dom.service';
/**
 * @record
 */
export function IDocumentService() { }
if (false) {
    /**
     * @param {?} elementRef
     * @return {?}
     */
    IDocumentService.prototype.getElementFixedTop = function (elementRef) { };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    IDocumentService.prototype.getElementFixedLeft = function (elementRef) { };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    IDocumentService.prototype.getElementAbsoluteTop = function (elementRef) { };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    IDocumentService.prototype.getElementAbsoluteLeft = function (elementRef) { };
    /**
     * @return {?}
     */
    IDocumentService.prototype.setDocumentHeight = function () { };
    /**
     * @return {?}
     */
    IDocumentService.prototype.getDocumentHeight = function () { };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    IDocumentService.prototype.isParentScrollable = function (elementRef) { };
    /**
     * @param {?} elementRef
     * @param {?} isElementFixed
     * @param {?} keywordToDiscard
     * @return {?}
     */
    IDocumentService.prototype.isElementBeyondOthers = function (elementRef, isElementFixed, keywordToDiscard) { };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    IDocumentService.prototype.scrollToTheTop = function (elementRef) { };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    IDocumentService.prototype.scrollToTheBottom = function (elementRef) { };
}
var DocumentService = /** @class */ (function () {
    function DocumentService(DOMService) {
        this.DOMService = DOMService;
        this.setDocumentHeight();
        if (!document.elementsFromPoint) {
            // IE 11 - Edge browsers
            document.elementsFromPoint = this.elementsFromPoint.bind(this);
        }
    }
    /**
     * @param {?} elementRef
     * @return {?}
     */
    DocumentService.prototype.getElementFixedTop = /**
     * @param {?} elementRef
     * @return {?}
     */
    function (elementRef) {
        return elementRef.nativeElement.getBoundingClientRect().top;
    };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    DocumentService.prototype.getElementFixedLeft = /**
     * @param {?} elementRef
     * @return {?}
     */
    function (elementRef) {
        return elementRef.nativeElement.getBoundingClientRect().left;
    };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    DocumentService.prototype.getElementAbsoluteTop = /**
     * @param {?} elementRef
     * @return {?}
     */
    function (elementRef) {
        /** @type {?} */
        var scrollOffsets = this.getScrollOffsets();
        return (elementRef.nativeElement.getBoundingClientRect().top +
            scrollOffsets.y);
    };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    DocumentService.prototype.getElementAbsoluteLeft = /**
     * @param {?} elementRef
     * @return {?}
     */
    function (elementRef) {
        /** @type {?} */
        var scrollOffsets = this.getScrollOffsets();
        return (elementRef.nativeElement.getBoundingClientRect().left +
            scrollOffsets.x);
    };
    /**
     * @return {?}
     */
    DocumentService.prototype.setDocumentHeight = /**
     * @return {?}
     */
    function () {
        this.documentHeight = this.calculateDocumentHeight();
    };
    /**
     * @return {?}
     */
    DocumentService.prototype.getDocumentHeight = /**
     * @return {?}
     */
    function () {
        return this.documentHeight;
    };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    DocumentService.prototype.isParentScrollable = /**
     * @param {?} elementRef
     * @return {?}
     */
    function (elementRef) {
        return (this.getFirstScrollableParent(elementRef.nativeElement) !==
            this.DOMService.getNativeDocument().body);
    };
    /**
     * @param {?} elementRef
     * @param {?} isElementFixed
     * @param {?} keywordToDiscard
     * @return {?}
     */
    DocumentService.prototype.isElementBeyondOthers = /**
     * @param {?} elementRef
     * @param {?} isElementFixed
     * @param {?} keywordToDiscard
     * @return {?}
     */
    function (elementRef, isElementFixed, keywordToDiscard) {
        /** @type {?} */
        var x1 = isElementFixed
            ? this.getElementFixedLeft(elementRef)
            : this.getElementAbsoluteLeft(elementRef);
        /** @type {?} */
        var y1 = isElementFixed
            ? this.getElementFixedTop(elementRef)
            : this.getElementAbsoluteTop(elementRef);
        /** @type {?} */
        var x2 = x1 + elementRef.nativeElement.getBoundingClientRect().width - 1;
        /** @type {?} */
        var y2 = y1 + elementRef.nativeElement.getBoundingClientRect().height - 1;
        /** @type {?} */
        var elements1 = this.DOMService.getNativeDocument().elementsFromPoint(x1, y1);
        /** @type {?} */
        var elements2 = this.DOMService.getNativeDocument().elementsFromPoint(x2, y2);
        if (elements1.length === 0 && elements2.length === 0)
            return 1;
        if (this.getFirstElementWithoutKeyword(elements1, keywordToDiscard) !==
            elementRef.nativeElement ||
            this.getFirstElementWithoutKeyword(elements2, keywordToDiscard) !==
                elementRef.nativeElement) {
            return 2;
        }
        return 3;
    };
    /**
     * @param {?} elementRef
     * @param {?} isElementFixed
     * @return {?}
     */
    DocumentService.prototype.scrollIntoView = /**
     * @param {?} elementRef
     * @param {?} isElementFixed
     * @return {?}
     */
    function (elementRef, isElementFixed) {
        /** @type {?} */
        var firstScrollableParent = this.getFirstScrollableParent(elementRef.nativeElement);
        /** @type {?} */
        var top = isElementFixed
            ? this.getElementFixedTop(elementRef)
            : this.getElementAbsoluteTop(elementRef);
        if (firstScrollableParent !== this.DOMService.getNativeDocument().body) {
            if (firstScrollableParent.scrollTo) {
                firstScrollableParent.scrollTo(0, top - 150);
            }
            else {
                // IE 11 - Edge browsers
                firstScrollableParent.scrollTop = top - 150;
            }
        }
        else {
            this.DOMService.getNativeWindow().scrollTo(0, top - 150);
        }
    };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    DocumentService.prototype.scrollToTheTop = /**
     * @param {?} elementRef
     * @return {?}
     */
    function (elementRef) {
        /** @type {?} */
        var firstScrollableParent = this.getFirstScrollableParent(elementRef.nativeElement);
        if (firstScrollableParent !== this.DOMService.getNativeDocument().body) {
            if (firstScrollableParent.scrollTo) {
                firstScrollableParent.scrollTo(0, 0);
            }
            else {
                // IE 11 - Edge browsers
                firstScrollableParent.scrollTop = 0;
            }
        }
        else {
            this.DOMService.getNativeWindow().scrollTo(0, 0);
        }
    };
    /**
     * @param {?} elementRef
     * @return {?}
     */
    DocumentService.prototype.scrollToTheBottom = /**
     * @param {?} elementRef
     * @return {?}
     */
    function (elementRef) {
        /** @type {?} */
        var firstScrollableParent = this.getFirstScrollableParent(elementRef.nativeElement);
        if (firstScrollableParent !== this.DOMService.getNativeDocument().body) {
            if (firstScrollableParent.scrollTo) {
                firstScrollableParent.scrollTo(0, this.DOMService.getNativeDocument().body.scrollHeight);
            }
            else {
                // IE 11 - Edge browsers
                firstScrollableParent.scrollTop =
                    firstScrollableParent.scrollHeight -
                        firstScrollableParent.clientHeight;
            }
        }
        else {
            this.DOMService.getNativeWindow().scrollTo(0, this.DOMService.getNativeDocument().body.scrollHeight);
        }
    };
    /**
     * @private
     * @param {?} node
     * @return {?}
     */
    DocumentService.prototype.getFirstScrollableParent = /**
     * @private
     * @param {?} node
     * @return {?}
     */
    function (node) {
        var _this = this;
        /** @type {?} */
        var regex = /(auto|scroll|overlay)/;
        /** @type {?} */
        var style = (/**
         * @param {?} node
         * @param {?} prop
         * @return {?}
         */
        function (node, prop) {
            return _this.DOMService.getNativeWindow()
                .getComputedStyle(node, null)
                .getPropertyValue(prop);
        });
        /** @type {?} */
        var scroll = (/**
         * @param {?} node
         * @return {?}
         */
        function (node) {
            return regex.test(style(node, 'overflow') +
                style(node, 'overflow-y') +
                style(node, 'overflow-x'));
        });
        /** @type {?} */
        var scrollparent = (/**
         * @param {?} node
         * @return {?}
         */
        function (node) {
            return !node || node === _this.DOMService.getNativeDocument().body
                ? _this.DOMService.getNativeDocument().body
                : scroll(node)
                    ? node
                    : scrollparent(node.parentNode);
        });
        return scrollparent(node);
    };
    /**
     * @private
     * @return {?}
     */
    DocumentService.prototype.calculateDocumentHeight = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var documentRef = this.DOMService.getNativeDocument();
        return Math.max(documentRef.body.scrollHeight, documentRef.documentElement.scrollHeight, documentRef.body.offsetHeight, documentRef.documentElement.offsetHeight, documentRef.body.clientHeight, documentRef.documentElement.clientHeight);
    };
    /**
     * @private
     * @return {?}
     */
    DocumentService.prototype.getScrollOffsets = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var winReference = this.DOMService.getNativeWindow();
        /** @type {?} */
        var docReference = this.DOMService.getNativeDocument();
        // This works for all browsers except IE versions 8 and before
        if (winReference.pageXOffset != null)
            return { x: winReference.pageXOffset, y: winReference.pageYOffset };
        // For IE (or any browser) in Standards mode
        if (docReference.compatMode == 'CSS1Compat')
            return {
                x: docReference.documentElement.scrollLeft,
                y: docReference.documentElement.scrollTop
            };
        // For browsers in Quirks mode
        return {
            x: docReference.body.scrollLeft,
            y: docReference.body.scrollTop
        };
    };
    /**
     * @private
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    DocumentService.prototype.elementsFromPoint = /**
     * @private
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    function (x, y) {
        /** @type {?} */
        var parents = [];
        /** @type {?} */
        var parent = void 0;
        do {
            /** @type {?} */
            var elem = this.DOMService.getNativeDocument().elementFromPoint(x, y);
            if (elem && parent !== elem) {
                parent = elem;
                parents.push(parent);
                parent.style.pointerEvents = 'none';
            }
            else {
                parent = false;
            }
        } while (parent);
        parents.forEach((/**
         * @param {?} parent
         * @return {?}
         */
        function (parent) {
            return (parent.style.pointerEvents = 'all');
        }));
        return parents;
    };
    /**
     * @private
     * @param {?} elements
     * @param {?} keyword
     * @return {?}
     */
    DocumentService.prototype.getFirstElementWithoutKeyword = /**
     * @private
     * @param {?} elements
     * @param {?} keyword
     * @return {?}
     */
    function (elements, keyword) {
        while (elements[0] &&
            elements[0].classList.toString().includes(keyword)) {
            elements.shift();
        }
        return elements[0];
    };
    DocumentService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    DocumentService.ctorParameters = function () { return [
        { type: DomRefService }
    ]; };
    return DocumentService;
}());
export { DocumentService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    DocumentService.prototype.documentHeight;
    /**
     * @type {?}
     * @private
     */
    DocumentService.prototype.DOMService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9jdW1lbnQuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1qb3lyaWRlLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL2RvY3VtZW50LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFjLE1BQU0sZUFBZSxDQUFDO0FBQ3ZELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxlQUFlLENBQUM7Ozs7QUFFOUMsc0NBb0JDOzs7Ozs7SUFuQkcsMEVBQW1EOzs7OztJQUVuRCwyRUFBNEM7Ozs7O0lBRTVDLDZFQUE4Qzs7Ozs7SUFFOUMsOEVBQStDOzs7O0lBRS9DLCtEQUFvQjs7OztJQUVwQiwrREFBNEI7Ozs7O0lBQzVCLDBFQUFvRDs7Ozs7OztJQUNwRCwrR0FJVTs7Ozs7SUFDVixzRUFBNkM7Ozs7O0lBQzdDLHlFQUFnRDs7QUFHcEQ7SUFJSSx5QkFBNkIsVUFBeUI7UUFBekIsZUFBVSxHQUFWLFVBQVUsQ0FBZTtRQUNsRCxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLGlCQUFpQixFQUFFO1lBQzdCLHdCQUF3QjtZQUN4QixRQUFRLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNsRTtJQUNMLENBQUM7Ozs7O0lBRUQsNENBQWtCOzs7O0lBQWxCLFVBQW1CLFVBQXNCO1FBQ3JDLE9BQU8sVUFBVSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEdBQUcsQ0FBQztJQUNoRSxDQUFDOzs7OztJQUVELDZDQUFtQjs7OztJQUFuQixVQUFvQixVQUFzQjtRQUN0QyxPQUFPLFVBQVUsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxJQUFJLENBQUM7SUFDakUsQ0FBQzs7Ozs7SUFFRCwrQ0FBcUI7Ozs7SUFBckIsVUFBc0IsVUFBc0I7O1lBQ2xDLGFBQWEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7UUFDN0MsT0FBTyxDQUNILFVBQVUsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxHQUFHO1lBQ3BELGFBQWEsQ0FBQyxDQUFDLENBQ2xCLENBQUM7SUFDTixDQUFDOzs7OztJQUVELGdEQUFzQjs7OztJQUF0QixVQUF1QixVQUFzQjs7WUFDbkMsYUFBYSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRTtRQUM3QyxPQUFPLENBQ0gsVUFBVSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLElBQUk7WUFDckQsYUFBYSxDQUFDLENBQUMsQ0FDbEIsQ0FBQztJQUNOLENBQUM7Ozs7SUFFRCwyQ0FBaUI7OztJQUFqQjtRQUNJLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7SUFDekQsQ0FBQzs7OztJQUVELDJDQUFpQjs7O0lBQWpCO1FBQ0ksT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQy9CLENBQUM7Ozs7O0lBRUQsNENBQWtCOzs7O0lBQWxCLFVBQW1CLFVBQXNCO1FBQ3JDLE9BQU8sQ0FDSCxJQUFJLENBQUMsd0JBQXdCLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQztZQUN2RCxJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixFQUFFLENBQUMsSUFBSSxDQUMzQyxDQUFDO0lBQ04sQ0FBQzs7Ozs7OztJQUVELCtDQUFxQjs7Ozs7O0lBQXJCLFVBQ0ksVUFBc0IsRUFDdEIsY0FBdUIsRUFDdkIsZ0JBQXdCOztZQUVsQixFQUFFLEdBQUcsY0FBYztZQUNyQixDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQztZQUN0QyxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFVBQVUsQ0FBQzs7WUFDdkMsRUFBRSxHQUFHLGNBQWM7WUFDckIsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLENBQUM7WUFDckMsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUM7O1lBQ3RDLEVBQUUsR0FDSixFQUFFLEdBQUcsVUFBVSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEtBQUssR0FBRyxDQUFDOztZQUM3RCxFQUFFLEdBQ0osRUFBRSxHQUFHLFVBQVUsQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQzs7WUFFOUQsU0FBUyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxpQkFBaUIsQ0FDbkUsRUFBRSxFQUNGLEVBQUUsQ0FDTDs7WUFDSyxTQUFTLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLGlCQUFpQixDQUNuRSxFQUFFLEVBQ0YsRUFBRSxDQUNMO1FBRUQsSUFBSSxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxTQUFTLENBQUMsTUFBTSxLQUFLLENBQUM7WUFBRSxPQUFPLENBQUMsQ0FBQztRQUMvRCxJQUNJLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxTQUFTLEVBQUUsZ0JBQWdCLENBQUM7WUFDM0QsVUFBVSxDQUFDLGFBQWE7WUFDNUIsSUFBSSxDQUFDLDZCQUE2QixDQUFDLFNBQVMsRUFBRSxnQkFBZ0IsQ0FBQztnQkFDM0QsVUFBVSxDQUFDLGFBQWEsRUFDOUI7WUFDRSxPQUFPLENBQUMsQ0FBQztTQUNaO1FBQ0QsT0FBTyxDQUFDLENBQUM7SUFDYixDQUFDOzs7Ozs7SUFFRCx3Q0FBYzs7Ozs7SUFBZCxVQUFlLFVBQXNCLEVBQUUsY0FBdUI7O1lBQ3BELHFCQUFxQixHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FDdkQsVUFBVSxDQUFDLGFBQWEsQ0FDM0I7O1lBQ0ssR0FBRyxHQUFHLGNBQWM7WUFDdEIsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLENBQUM7WUFDckMsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUM7UUFDNUMsSUFDSSxxQkFBcUIsS0FBSyxJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixFQUFFLENBQUMsSUFBSSxFQUNwRTtZQUNFLElBQUkscUJBQXFCLENBQUMsUUFBUSxFQUFFO2dCQUNoQyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQzthQUNoRDtpQkFBTTtnQkFDSCx3QkFBd0I7Z0JBQ3hCLHFCQUFxQixDQUFDLFNBQVMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO2FBQy9DO1NBQ0o7YUFBTTtZQUNILElBQUksQ0FBQyxVQUFVLENBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7U0FDNUQ7SUFDTCxDQUFDOzs7OztJQUVELHdDQUFjOzs7O0lBQWQsVUFBZSxVQUFzQjs7WUFDM0IscUJBQXFCLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixDQUN2RCxVQUFVLENBQUMsYUFBYSxDQUMzQjtRQUNELElBQ0kscUJBQXFCLEtBQUssSUFBSSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLElBQUksRUFDcEU7WUFDRSxJQUFJLHFCQUFxQixDQUFDLFFBQVEsRUFBRTtnQkFDaEMscUJBQXFCLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQzthQUN4QztpQkFBTTtnQkFDSCx3QkFBd0I7Z0JBQ3hCLHFCQUFxQixDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7YUFDdkM7U0FDSjthQUFNO1lBQ0gsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3BEO0lBQ0wsQ0FBQzs7Ozs7SUFFRCwyQ0FBaUI7Ozs7SUFBakIsVUFBa0IsVUFBc0I7O1lBQzlCLHFCQUFxQixHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FDdkQsVUFBVSxDQUFDLGFBQWEsQ0FDM0I7UUFDRCxJQUNJLHFCQUFxQixLQUFLLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxJQUFJLEVBQ3BFO1lBQ0UsSUFBSSxxQkFBcUIsQ0FBQyxRQUFRLEVBQUU7Z0JBQ2hDLHFCQUFxQixDQUFDLFFBQVEsQ0FDMUIsQ0FBQyxFQUNELElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUN4RCxDQUFDO2FBQ0w7aUJBQU07Z0JBQ0gsd0JBQXdCO2dCQUN4QixxQkFBcUIsQ0FBQyxTQUFTO29CQUMzQixxQkFBcUIsQ0FBQyxZQUFZO3dCQUNsQyxxQkFBcUIsQ0FBQyxZQUFZLENBQUM7YUFDMUM7U0FDSjthQUFNO1lBQ0gsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQ3RDLENBQUMsRUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixFQUFFLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FDeEQsQ0FBQztTQUNMO0lBQ0wsQ0FBQzs7Ozs7O0lBRU8sa0RBQXdCOzs7OztJQUFoQyxVQUFpQyxJQUFTO1FBQTFDLGlCQXdCQzs7WUF2QlMsS0FBSyxHQUFHLHVCQUF1Qjs7WUFFL0IsS0FBSzs7Ozs7UUFBRyxVQUFDLElBQVMsRUFBRSxJQUFTO1lBQy9CLE9BQUEsS0FBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUU7aUJBQzVCLGdCQUFnQixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7aUJBQzVCLGdCQUFnQixDQUFDLElBQUksQ0FBQztRQUYzQixDQUUyQixDQUFBOztZQUV6QixNQUFNOzs7O1FBQUcsVUFBQyxJQUFTO1lBQ3JCLE9BQUEsS0FBSyxDQUFDLElBQUksQ0FDTixLQUFLLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQztnQkFDbkIsS0FBSyxDQUFDLElBQUksRUFBRSxZQUFZLENBQUM7Z0JBQ3pCLEtBQUssQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQ2hDO1FBSkQsQ0FJQyxDQUFBOztZQUVDLFlBQVk7Ozs7UUFBRyxVQUFDLElBQVM7WUFDM0IsT0FBTyxDQUFDLElBQUksSUFBSSxJQUFJLEtBQUssS0FBSSxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLElBQUk7Z0JBQzdELENBQUMsQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixFQUFFLENBQUMsSUFBSTtnQkFDMUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7b0JBQ2QsQ0FBQyxDQUFDLElBQUk7b0JBQ04sQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFBO1FBRUQsT0FBTyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUIsQ0FBQzs7Ozs7SUFFTyxpREFBdUI7Ozs7SUFBL0I7O1lBQ1UsV0FBVyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLEVBQUU7UUFDdkQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUNYLFdBQVcsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUM3QixXQUFXLENBQUMsZUFBZSxDQUFDLFlBQVksRUFDeEMsV0FBVyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQzdCLFdBQVcsQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUN4QyxXQUFXLENBQUMsSUFBSSxDQUFDLFlBQVksRUFDN0IsV0FBVyxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQzNDLENBQUM7SUFDTixDQUFDOzs7OztJQUVPLDBDQUFnQjs7OztJQUF4Qjs7WUFDVSxZQUFZLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUU7O1lBQ2hELFlBQVksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixFQUFFO1FBRXhELDhEQUE4RDtRQUM5RCxJQUFJLFlBQVksQ0FBQyxXQUFXLElBQUksSUFBSTtZQUNoQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUV4RSw0Q0FBNEM7UUFDNUMsSUFBSSxZQUFZLENBQUMsVUFBVSxJQUFJLFlBQVk7WUFDdkMsT0FBTztnQkFDSCxDQUFDLEVBQUUsWUFBWSxDQUFDLGVBQWUsQ0FBQyxVQUFVO2dCQUMxQyxDQUFDLEVBQUUsWUFBWSxDQUFDLGVBQWUsQ0FBQyxTQUFTO2FBQzVDLENBQUM7UUFFTiw4QkFBOEI7UUFDOUIsT0FBTztZQUNILENBQUMsRUFBRSxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVU7WUFDL0IsQ0FBQyxFQUFFLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUztTQUNqQyxDQUFDO0lBQ04sQ0FBQzs7Ozs7OztJQUVPLDJDQUFpQjs7Ozs7O0lBQXpCLFVBQTBCLENBQUMsRUFBRSxDQUFDOztZQUN0QixPQUFPLEdBQUcsRUFBRTs7WUFDWixNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ25CLEdBQUc7O2dCQUNPLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGlCQUFpQixFQUFFLENBQUMsZ0JBQWdCLENBQzdELENBQUMsRUFDRCxDQUFDLENBQ0o7WUFDRCxJQUFJLElBQUksSUFBSSxNQUFNLEtBQUssSUFBSSxFQUFFO2dCQUN6QixNQUFNLEdBQUcsSUFBSSxDQUFDO2dCQUNkLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3JCLE1BQU0sQ0FBQyxLQUFLLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQzthQUN2QztpQkFBTTtnQkFDSCxNQUFNLEdBQUcsS0FBSyxDQUFDO2FBQ2xCO1NBQ0osUUFBUSxNQUFNLEVBQUU7UUFDakIsT0FBTyxDQUFDLE9BQU87Ozs7UUFBQyxVQUFTLE1BQU07WUFDM0IsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxDQUFDO1FBQ2hELENBQUMsRUFBQyxDQUFDO1FBQ0gsT0FBTyxPQUFPLENBQUM7SUFDbkIsQ0FBQzs7Ozs7OztJQUVPLHVEQUE2Qjs7Ozs7O0lBQXJDLFVBQ0ksUUFBbUIsRUFDbkIsT0FBZTtRQUVmLE9BQ0ksUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNYLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUNwRDtZQUNFLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNwQjtRQUNELE9BQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7O2dCQXRQSixVQUFVOzs7O2dCQXhCRixhQUFhOztJQStRdEIsc0JBQUM7Q0FBQSxBQXZQRCxJQXVQQztTQXRQWSxlQUFlOzs7Ozs7SUFDeEIseUNBQStCOzs7OztJQUVuQixxQ0FBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IERvbVJlZlNlcnZpY2UgfSBmcm9tICcuL2RvbS5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSURvY3VtZW50U2VydmljZSB7XHJcbiAgICBnZXRFbGVtZW50Rml4ZWRUb3AoZWxlbWVudFJlZjogRWxlbWVudFJlZik6IG51bWJlcjtcclxuXHJcbiAgICBnZXRFbGVtZW50Rml4ZWRMZWZ0KGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpO1xyXG5cclxuICAgIGdldEVsZW1lbnRBYnNvbHV0ZVRvcChlbGVtZW50UmVmOiBFbGVtZW50UmVmKTtcclxuXHJcbiAgICBnZXRFbGVtZW50QWJzb2x1dGVMZWZ0KGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpO1xyXG5cclxuICAgIHNldERvY3VtZW50SGVpZ2h0KCk7XHJcblxyXG4gICAgZ2V0RG9jdW1lbnRIZWlnaHQoKTogbnVtYmVyO1xyXG4gICAgaXNQYXJlbnRTY3JvbGxhYmxlKGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpOiBib29sZWFuO1xyXG4gICAgaXNFbGVtZW50QmV5b25kT3RoZXJzKFxyXG4gICAgICAgIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgaXNFbGVtZW50Rml4ZWQ6IGJvb2xlYW4sXHJcbiAgICAgICAga2V5d29yZFRvRGlzY2FyZDogc3RyaW5nXHJcbiAgICApOiBudW1iZXI7XHJcbiAgICBzY3JvbGxUb1RoZVRvcChlbGVtZW50UmVmOiBFbGVtZW50UmVmKTogdm9pZDtcclxuICAgIHNjcm9sbFRvVGhlQm90dG9tKGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpOiB2b2lkO1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBEb2N1bWVudFNlcnZpY2UgaW1wbGVtZW50cyBJRG9jdW1lbnRTZXJ2aWNlIHtcclxuICAgIHByaXZhdGUgZG9jdW1lbnRIZWlnaHQ6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IERPTVNlcnZpY2U6IERvbVJlZlNlcnZpY2UpIHtcclxuICAgICAgICB0aGlzLnNldERvY3VtZW50SGVpZ2h0KCk7XHJcbiAgICAgICAgaWYgKCFkb2N1bWVudC5lbGVtZW50c0Zyb21Qb2ludCkge1xyXG4gICAgICAgICAgICAvLyBJRSAxMSAtIEVkZ2UgYnJvd3NlcnNcclxuICAgICAgICAgICAgZG9jdW1lbnQuZWxlbWVudHNGcm9tUG9pbnQgPSB0aGlzLmVsZW1lbnRzRnJvbVBvaW50LmJpbmQodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldEVsZW1lbnRGaXhlZFRvcChlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0RWxlbWVudEZpeGVkTGVmdChlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xyXG4gICAgfVxyXG5cclxuICAgIGdldEVsZW1lbnRBYnNvbHV0ZVRvcChlbGVtZW50UmVmOiBFbGVtZW50UmVmKSB7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsT2Zmc2V0cyA9IHRoaXMuZ2V0U2Nyb2xsT2Zmc2V0cygpO1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgK1xyXG4gICAgICAgICAgICBzY3JvbGxPZmZzZXRzLnlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGdldEVsZW1lbnRBYnNvbHV0ZUxlZnQoZWxlbWVudFJlZjogRWxlbWVudFJlZikge1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbE9mZnNldHMgPSB0aGlzLmdldFNjcm9sbE9mZnNldHMoKTtcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCArXHJcbiAgICAgICAgICAgIHNjcm9sbE9mZnNldHMueFxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0RG9jdW1lbnRIZWlnaHQoKSB7XHJcbiAgICAgICAgdGhpcy5kb2N1bWVudEhlaWdodCA9IHRoaXMuY2FsY3VsYXRlRG9jdW1lbnRIZWlnaHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXREb2N1bWVudEhlaWdodCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudEhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBpc1BhcmVudFNjcm9sbGFibGUoZWxlbWVudFJlZjogRWxlbWVudFJlZik6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAoXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Rmlyc3RTY3JvbGxhYmxlUGFyZW50KGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkgIT09XHJcbiAgICAgICAgICAgIHRoaXMuRE9NU2VydmljZS5nZXROYXRpdmVEb2N1bWVudCgpLmJvZHlcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGlzRWxlbWVudEJleW9uZE90aGVycyhcclxuICAgICAgICBlbGVtZW50UmVmOiBFbGVtZW50UmVmLFxyXG4gICAgICAgIGlzRWxlbWVudEZpeGVkOiBib29sZWFuLFxyXG4gICAgICAgIGtleXdvcmRUb0Rpc2NhcmQ6IHN0cmluZ1xyXG4gICAgKSB7XHJcbiAgICAgICAgY29uc3QgeDEgPSBpc0VsZW1lbnRGaXhlZFxyXG4gICAgICAgICAgICA/IHRoaXMuZ2V0RWxlbWVudEZpeGVkTGVmdChlbGVtZW50UmVmKVxyXG4gICAgICAgICAgICA6IHRoaXMuZ2V0RWxlbWVudEFic29sdXRlTGVmdChlbGVtZW50UmVmKTtcclxuICAgICAgICBjb25zdCB5MSA9IGlzRWxlbWVudEZpeGVkXHJcbiAgICAgICAgICAgID8gdGhpcy5nZXRFbGVtZW50Rml4ZWRUb3AoZWxlbWVudFJlZilcclxuICAgICAgICAgICAgOiB0aGlzLmdldEVsZW1lbnRBYnNvbHV0ZVRvcChlbGVtZW50UmVmKTtcclxuICAgICAgICBjb25zdCB4MiA9XHJcbiAgICAgICAgICAgIHgxICsgZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIC0gMTtcclxuICAgICAgICBjb25zdCB5MiA9XHJcbiAgICAgICAgICAgIHkxICsgZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCAtIDE7XHJcblxyXG4gICAgICAgIGNvbnN0IGVsZW1lbnRzMSA9IHRoaXMuRE9NU2VydmljZS5nZXROYXRpdmVEb2N1bWVudCgpLmVsZW1lbnRzRnJvbVBvaW50KFxyXG4gICAgICAgICAgICB4MSxcclxuICAgICAgICAgICAgeTFcclxuICAgICAgICApO1xyXG4gICAgICAgIGNvbnN0IGVsZW1lbnRzMiA9IHRoaXMuRE9NU2VydmljZS5nZXROYXRpdmVEb2N1bWVudCgpLmVsZW1lbnRzRnJvbVBvaW50KFxyXG4gICAgICAgICAgICB4MixcclxuICAgICAgICAgICAgeTJcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAoZWxlbWVudHMxLmxlbmd0aCA9PT0gMCAmJiBlbGVtZW50czIubGVuZ3RoID09PSAwKSByZXR1cm4gMTtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Rmlyc3RFbGVtZW50V2l0aG91dEtleXdvcmQoZWxlbWVudHMxLCBrZXl3b3JkVG9EaXNjYXJkKSAhPT1cclxuICAgICAgICAgICAgICAgIGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCB8fFxyXG4gICAgICAgICAgICB0aGlzLmdldEZpcnN0RWxlbWVudFdpdGhvdXRLZXl3b3JkKGVsZW1lbnRzMiwga2V5d29yZFRvRGlzY2FyZCkgIT09XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnRcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgcmV0dXJuIDI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAzO1xyXG4gICAgfVxyXG5cclxuICAgIHNjcm9sbEludG9WaWV3KGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsIGlzRWxlbWVudEZpeGVkOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZmlyc3RTY3JvbGxhYmxlUGFyZW50ID0gdGhpcy5nZXRGaXJzdFNjcm9sbGFibGVQYXJlbnQoXHJcbiAgICAgICAgICAgIGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgY29uc3QgdG9wID0gaXNFbGVtZW50Rml4ZWRcclxuICAgICAgICAgICAgPyB0aGlzLmdldEVsZW1lbnRGaXhlZFRvcChlbGVtZW50UmVmKVxyXG4gICAgICAgICAgICA6IHRoaXMuZ2V0RWxlbWVudEFic29sdXRlVG9wKGVsZW1lbnRSZWYpO1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgICAgZmlyc3RTY3JvbGxhYmxlUGFyZW50ICE9PSB0aGlzLkRPTVNlcnZpY2UuZ2V0TmF0aXZlRG9jdW1lbnQoKS5ib2R5XHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIGlmIChmaXJzdFNjcm9sbGFibGVQYXJlbnQuc2Nyb2xsVG8pIHtcclxuICAgICAgICAgICAgICAgIGZpcnN0U2Nyb2xsYWJsZVBhcmVudC5zY3JvbGxUbygwLCB0b3AgLSAxNTApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gSUUgMTEgLSBFZGdlIGJyb3dzZXJzXHJcbiAgICAgICAgICAgICAgICBmaXJzdFNjcm9sbGFibGVQYXJlbnQuc2Nyb2xsVG9wID0gdG9wIC0gMTUwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZVdpbmRvdygpLnNjcm9sbFRvKDAsIHRvcCAtIDE1MCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNjcm9sbFRvVGhlVG9wKGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBmaXJzdFNjcm9sbGFibGVQYXJlbnQgPSB0aGlzLmdldEZpcnN0U2Nyb2xsYWJsZVBhcmVudChcclxuICAgICAgICAgICAgZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50XHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgIGZpcnN0U2Nyb2xsYWJsZVBhcmVudCAhPT0gdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZURvY3VtZW50KCkuYm9keVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICBpZiAoZmlyc3RTY3JvbGxhYmxlUGFyZW50LnNjcm9sbFRvKSB7XHJcbiAgICAgICAgICAgICAgICBmaXJzdFNjcm9sbGFibGVQYXJlbnQuc2Nyb2xsVG8oMCwgMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJRSAxMSAtIEVkZ2UgYnJvd3NlcnNcclxuICAgICAgICAgICAgICAgIGZpcnN0U2Nyb2xsYWJsZVBhcmVudC5zY3JvbGxUb3AgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZVdpbmRvdygpLnNjcm9sbFRvKDAsIDApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzY3JvbGxUb1RoZUJvdHRvbShlbGVtZW50UmVmOiBFbGVtZW50UmVmKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgZmlyc3RTY3JvbGxhYmxlUGFyZW50ID0gdGhpcy5nZXRGaXJzdFNjcm9sbGFibGVQYXJlbnQoXHJcbiAgICAgICAgICAgIGVsZW1lbnRSZWYubmF0aXZlRWxlbWVudFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBmaXJzdFNjcm9sbGFibGVQYXJlbnQgIT09IHRoaXMuRE9NU2VydmljZS5nZXROYXRpdmVEb2N1bWVudCgpLmJvZHlcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgaWYgKGZpcnN0U2Nyb2xsYWJsZVBhcmVudC5zY3JvbGxUbykge1xyXG4gICAgICAgICAgICAgICAgZmlyc3RTY3JvbGxhYmxlUGFyZW50LnNjcm9sbFRvKFxyXG4gICAgICAgICAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZURvY3VtZW50KCkuYm9keS5zY3JvbGxIZWlnaHRcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJRSAxMSAtIEVkZ2UgYnJvd3NlcnNcclxuICAgICAgICAgICAgICAgIGZpcnN0U2Nyb2xsYWJsZVBhcmVudC5zY3JvbGxUb3AgPVxyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0U2Nyb2xsYWJsZVBhcmVudC5zY3JvbGxIZWlnaHQgLVxyXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0U2Nyb2xsYWJsZVBhcmVudC5jbGllbnRIZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLkRPTVNlcnZpY2UuZ2V0TmF0aXZlV2luZG93KCkuc2Nyb2xsVG8oXHJcbiAgICAgICAgICAgICAgICAwLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZURvY3VtZW50KCkuYm9keS5zY3JvbGxIZWlnaHRcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRGaXJzdFNjcm9sbGFibGVQYXJlbnQobm9kZTogYW55KSB7XHJcbiAgICAgICAgY29uc3QgcmVnZXggPSAvKGF1dG98c2Nyb2xsfG92ZXJsYXkpLztcclxuXHJcbiAgICAgICAgY29uc3Qgc3R5bGUgPSAobm9kZTogYW55LCBwcm9wOiBhbnkpID0+XHJcbiAgICAgICAgICAgIHRoaXMuRE9NU2VydmljZS5nZXROYXRpdmVXaW5kb3coKVxyXG4gICAgICAgICAgICAgICAgLmdldENvbXB1dGVkU3R5bGUobm9kZSwgbnVsbClcclxuICAgICAgICAgICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKHByb3ApO1xyXG5cclxuICAgICAgICBjb25zdCBzY3JvbGwgPSAobm9kZTogYW55KSA9PlxyXG4gICAgICAgICAgICByZWdleC50ZXN0KFxyXG4gICAgICAgICAgICAgICAgc3R5bGUobm9kZSwgJ292ZXJmbG93JykgK1xyXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlKG5vZGUsICdvdmVyZmxvdy15JykgK1xyXG4gICAgICAgICAgICAgICAgICAgIHN0eWxlKG5vZGUsICdvdmVyZmxvdy14JylcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgY29uc3Qgc2Nyb2xscGFyZW50ID0gKG5vZGU6IGFueSk6IGFueSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiAhbm9kZSB8fCBub2RlID09PSB0aGlzLkRPTVNlcnZpY2UuZ2V0TmF0aXZlRG9jdW1lbnQoKS5ib2R5XHJcbiAgICAgICAgICAgICAgICA/IHRoaXMuRE9NU2VydmljZS5nZXROYXRpdmVEb2N1bWVudCgpLmJvZHlcclxuICAgICAgICAgICAgICAgIDogc2Nyb2xsKG5vZGUpXHJcbiAgICAgICAgICAgICAgICA/IG5vZGVcclxuICAgICAgICAgICAgICAgIDogc2Nyb2xscGFyZW50KG5vZGUucGFyZW50Tm9kZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNjcm9sbHBhcmVudChub2RlKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbGN1bGF0ZURvY3VtZW50SGVpZ2h0KCkge1xyXG4gICAgICAgIGNvbnN0IGRvY3VtZW50UmVmID0gdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZURvY3VtZW50KCk7XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KFxyXG4gICAgICAgICAgICBkb2N1bWVudFJlZi5ib2R5LnNjcm9sbEhlaWdodCxcclxuICAgICAgICAgICAgZG9jdW1lbnRSZWYuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCxcclxuICAgICAgICAgICAgZG9jdW1lbnRSZWYuYm9keS5vZmZzZXRIZWlnaHQsXHJcbiAgICAgICAgICAgIGRvY3VtZW50UmVmLmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQsXHJcbiAgICAgICAgICAgIGRvY3VtZW50UmVmLmJvZHkuY2xpZW50SGVpZ2h0LFxyXG4gICAgICAgICAgICBkb2N1bWVudFJlZi5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFNjcm9sbE9mZnNldHMoKSB7XHJcbiAgICAgICAgY29uc3Qgd2luUmVmZXJlbmNlID0gdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZVdpbmRvdygpO1xyXG4gICAgICAgIGNvbnN0IGRvY1JlZmVyZW5jZSA9IHRoaXMuRE9NU2VydmljZS5nZXROYXRpdmVEb2N1bWVudCgpO1xyXG5cclxuICAgICAgICAvLyBUaGlzIHdvcmtzIGZvciBhbGwgYnJvd3NlcnMgZXhjZXB0IElFIHZlcnNpb25zIDggYW5kIGJlZm9yZVxyXG4gICAgICAgIGlmICh3aW5SZWZlcmVuY2UucGFnZVhPZmZzZXQgIT0gbnVsbClcclxuICAgICAgICAgICAgcmV0dXJuIHsgeDogd2luUmVmZXJlbmNlLnBhZ2VYT2Zmc2V0LCB5OiB3aW5SZWZlcmVuY2UucGFnZVlPZmZzZXQgfTtcclxuXHJcbiAgICAgICAgLy8gRm9yIElFIChvciBhbnkgYnJvd3NlcikgaW4gU3RhbmRhcmRzIG1vZGVcclxuICAgICAgICBpZiAoZG9jUmVmZXJlbmNlLmNvbXBhdE1vZGUgPT0gJ0NTUzFDb21wYXQnKVxyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgeDogZG9jUmVmZXJlbmNlLmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0LFxyXG4gICAgICAgICAgICAgICAgeTogZG9jUmVmZXJlbmNlLmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3BcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gRm9yIGJyb3dzZXJzIGluIFF1aXJrcyBtb2RlXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgeDogZG9jUmVmZXJlbmNlLmJvZHkuc2Nyb2xsTGVmdCxcclxuICAgICAgICAgICAgeTogZG9jUmVmZXJlbmNlLmJvZHkuc2Nyb2xsVG9wXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGVsZW1lbnRzRnJvbVBvaW50KHgsIHkpIHtcclxuICAgICAgICB2YXIgcGFyZW50cyA9IFtdO1xyXG4gICAgICAgIHZhciBwYXJlbnQgPSB2b2lkIDA7XHJcbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICBjb25zdCBlbGVtID0gdGhpcy5ET01TZXJ2aWNlLmdldE5hdGl2ZURvY3VtZW50KCkuZWxlbWVudEZyb21Qb2ludChcclxuICAgICAgICAgICAgICAgIHgsXHJcbiAgICAgICAgICAgICAgICB5XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGlmIChlbGVtICYmIHBhcmVudCAhPT0gZWxlbSkge1xyXG4gICAgICAgICAgICAgICAgcGFyZW50ID0gZWxlbTtcclxuICAgICAgICAgICAgICAgIHBhcmVudHMucHVzaChwYXJlbnQpO1xyXG4gICAgICAgICAgICAgICAgcGFyZW50LnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwYXJlbnQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gd2hpbGUgKHBhcmVudCk7XHJcbiAgICAgICAgcGFyZW50cy5mb3JFYWNoKGZ1bmN0aW9uKHBhcmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gKHBhcmVudC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2FsbCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBwYXJlbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Rmlyc3RFbGVtZW50V2l0aG91dEtleXdvcmQoXHJcbiAgICAgICAgZWxlbWVudHM6IEVsZW1lbnRbXSxcclxuICAgICAgICBrZXl3b3JkOiBzdHJpbmdcclxuICAgICk6IEVsZW1lbnQge1xyXG4gICAgICAgIHdoaWxlIChcclxuICAgICAgICAgICAgZWxlbWVudHNbMF0gJiZcclxuICAgICAgICAgICAgZWxlbWVudHNbMF0uY2xhc3NMaXN0LnRvU3RyaW5nKCkuaW5jbHVkZXMoa2V5d29yZClcclxuICAgICAgICApIHtcclxuICAgICAgICAgICAgZWxlbWVudHMuc2hpZnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnRzWzBdO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==